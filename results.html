<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sonuçlar – Retail Bülten Yarışmaları</title>
<style>
  body{margin:0;background:#0f1115;color:#e8ecf1;font-family:Inter,system-ui,sans-serif}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  h1{margin:0 0 6px}
  p.sub{margin:0 0 18px;color:#9aa0b3}
  .toolbar{display:flex;gap:10px;align-items:center;margin:10px 0 16px;flex-wrap:wrap}
  .badge{font-size:12px;color:#a6afc3;border:1px solid #2a2f44;padding:6px 10px;border-radius:999px}
  .tabs{display:flex;gap:8px;margin:6px 0 16px}
  .tab{background:#151824;border:1px solid #20263a;color:#e8ecf1;border-radius:10px;padding:8px 12px;cursor:pointer}
  .tab.active{background:#6ea8fe;color:#071222;border-color:#6ea8fe}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
  .card{background:#151824;border:1px solid #20263a;border-radius:14px;overflow:hidden}
  .thumb{width:100%;aspect-ratio:4/3;object-fit:cover;background:#0b0e15}
  .row{display:flex;align-items:center;gap:10px;padding:10px 12px}
  .title{font-weight:600}
  .score{margin-left:auto;background:#1b2438;border:1px solid #29324b;border-radius:999px;padding:6px 10px;font-weight:800}
  a{color:#9dccff}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Sonuçlar</h1>
    <p class="sub">Fotoğraf ve Çizim sekmeleri arasında geçiş yaparak toplam oyları ve sıralamayı görebilirsiniz.</p>

    <div class="toolbar">
      <a class="badge" href="index.html">← Ana sayfa</a>
      <span class="badge" id="totalVotes">Toplam oy: 0</span>
      <button id="refreshBtn" class="badge" style="cursor:pointer">Yenile</button>
      <label class="badge" style="cursor:pointer">
        <input id="autoRefresh" type="checkbox" style="vertical-align:middle;margin-right:6px">Otomatik yenile (15 sn)
      </label>
    </div>

    <div class="tabs">
      <button id="tabPhoto" class="tab active">Fotoğraf</button>
      <button id="tabDrawing" class="tab">Çizim</button>
    </div>

    <div id="grid" class="grid"></div>
  </div>

<script>
  // ==== AYARLAR ====
  const API_BASE = "https://script.google.com/macros/s/AKfycbz1oeJv3JdO6v5sB87AlcJMqKS8Rbjqb6sR73u235KmBZpNn9DscySfujcVQf7-lz6Eww/exec";

  // Gerçek sayılara göre güncelle:
  const PHOTO_COUNT   = 42;
  const DRAWING_COUNT = 42;

  // ==================
  const grid = document.getElementById('grid');
  const totalVotesEl = document.getElementById('totalVotes');
  const tabPhoto = document.getElementById('tabPhoto');
  const tabDrawing = document.getElementById('tabDrawing');
  const refreshBtn = document.getElementById('refreshBtn');
  const autoRefresh = document.getElementById('autoRefresh');

  let ACTIVE_KIND = 'photo'; // photo | drawing
  let timer = null;

  function buildList(kind){
    const n = kind==='drawing' ? DRAWING_COUNT : PHOTO_COUNT;
    const prefix = kind==='drawing' ? 'drawing' : 'photo';
    const labelPrefix = kind==='drawing' ? 'Drawing #' : 'Photo #';
    return Array.from({length:n},(_,i)=>{
      const id = String(i+1).padStart(2,'0');
      return { id, label: `${labelPrefix}${id}`, src: `images/${prefix}-${id}.jpg` };
    });
  }

  function render(kind, counts){
    const LIST = buildList(kind);
    grid.innerHTML = '';
    let total = 0;
    const data = LIST.map(p=>({ ...p, score: (counts[p.label]||0) })).sort((a,b)=> b.score - a.score);
    data.forEach(p=> total += p.score );
    totalVotesEl.textContent = `Toplam oy: ${total}`;

    if (LIST.length===0) {
      grid.innerHTML = '<div style="opacity:.8">Bu kategoride şu an görsel yok.</div>';
      return;
    }

    data.forEach(p=>{
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img class="thumb" src="${p.src}" alt="${p.label}" onerror="this.style.opacity=0.25">
        <div class="row">
          <div class="title">${p.label}</div>
          <div class="score">${p.score}</div>
        </div>`;
      grid.appendChild(card);
    });
  }

  async function load(kind){
    ACTIVE_KIND = kind;
    const res = await fetch(API_BASE + `?kind=${kind}`);
    const json = await res.json();
    if(json && json.ok){
      render(kind, json.counts || {});
    }else{
      grid.innerHTML = '<div style="color:#ff9a9a">Hata: Sonuçlar yüklenemedi.</div>';
    }
  }

  function setActiveTab(){
    if (ACTIVE_KIND==='photo'){ tabPhoto.classList.add('active'); tabDrawing.classList.remove('active'); }
    else { tabDrawing.classList.add('active'); tabPhoto.classList.remove('active'); }
  }

  tabPhoto.addEventListener('click', ()=>{ ACTIVE_KIND='photo'; setActiveTab(); load('photo'); });
  tabDrawing.addEventListener('click', ()=>{ ACTIVE_KIND='drawing'; setActiveTab(); load('drawing'); });
  refreshBtn.addEventListener('click', ()=> load(ACTIVE_KIND));

  autoRefresh.addEventListener('change', ()=>{
    if (autoRefresh.checked){
      timer = setInterval(()=> load(ACTIVE_KIND), 15000);
    } else {
      if (timer) clearInterval(timer);
    }
  });

  // İlk yükleme:
  setActiveTab();
  load('photo');
</script>
</body>
</html>
